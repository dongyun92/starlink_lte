
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤íƒ€ë§í¬ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0B1426 0%, #1A2D5A 100%);
            color: white; min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #00D2FF; margin-bottom: 10px; }
        .status-bar { 
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; backdrop-filter: blur(10px);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { 
            background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
        }
        .card h3 { color: #00D2FF; margin-bottom: 15px; }
        .metric { display: flex; justify-content: space-between; margin: 10px 0; }
        .metric-value { font-weight: bold; }
        .status-good { color: #4CAF50; }
        .status-warning { color: #FF9800; }
        .status-error { color: #F44336; }
        .controls { text-align: center; margin: 20px 0; }
        .btn { 
            background: #00D2FF; color: white; border: none; padding: 10px 20px;
            border-radius: 5px; margin: 0 10px; cursor: pointer; font-size: 16px;
        }
        .btn:hover { background: #00B8E6; }
        .btn.stop { background: #F44336; }
        .btn.stop:hover { background: #D32F2F; }
        .chart-container { height: 200px; margin-top: 15px; }
        .realtime-indicator { 
            position: fixed; top: 10px; right: 10px; 
            background: #4CAF50; color: white; padding: 5px 10px; 
            border-radius: 5px; font-size: 12px;
        }
        .connection-status {
            color: #4CAF50;
            font-size: 14px;
            margin-left: 10px;
        }
        .disconnected { color: #F44336; }
    </style>
</head>
<body>
    <div class="realtime-indicator" id="realtime-status">ğŸ”´ ì—°ê²° ëŒ€ê¸°</div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ›°ï¸ ìŠ¤íƒ€ë§í¬ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</h1>
            <p>WebSocket ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</p>
        </div>
        
        <div class="status-bar">
            <div>
                <strong>API ìƒíƒœ:</strong> <span id="api-status" class="status-good">ì—°ê²°ë¨</span>
                <span class="connection-status" id="websocket-status">WebSocket: ì—°ê²° ì¤‘...</span>
            </div>
            <div>
                <strong>ì—…íƒ€ì„:</strong> <span id="uptime">00:00:00</span>
            </div>
            <div>
                <strong>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</strong> <span id="last-update">-</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="startMonitoring()">ğŸš€ ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
            <button class="btn stop" onclick="stopMonitoring()">â¹ï¸ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
            <button class="btn" onclick="testWebSocket()">ğŸ”§ WebSocket í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>ğŸ“¡ ì—°ê²° ìƒíƒœ</h3>
                <div class="metric">
                    <span>API ìƒíƒœ:</span>
                    <span id="connection-api" class="metric-value">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metric">
                    <span>gRPC ìƒíƒœ:</span>
                    <span id="connection-grpc" class="metric-value">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metric">
                    <span>Ping ì§€ì—°ì‹œê°„:</span>
                    <span id="ping-latency" class="metric-value">0 ms</span>
                </div>
                <div class="metric">
                    <span>ì‹ í˜¸ ê°•ë„:</span>
                    <span id="signal-strength" class="metric-value">0%</span>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥</h3>
                <div class="metric">
                    <span>ë‹¤ìš´ë¡œë“œ ì†ë„:</span>
                    <span id="download-speed" class="metric-value">0 Mbps</span>
                </div>
                <div class="metric">
                    <span>ì—…ë¡œë“œ ì†ë„:</span>
                    <span id="upload-speed" class="metric-value">0 Mbps</span>
                </div>
                <div class="metric">
                    <span>ì§€ì—°ì‹œê°„:</span>
                    <span id="network-latency" class="metric-value">0 ms</span>
                </div>
                <div class="metric">
                    <span>ìœ„ì„± ê°œìˆ˜:</span>
                    <span id="satellite-count" class="metric-value">0</span>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸ’» ì‹œìŠ¤í…œ ì„±ëŠ¥</h3>
                <div class="metric">
                    <span>CPU ì‚¬ìš©ë¥ :</span>
                    <span id="cpu-usage" class="metric-value">0%</span>
                </div>
                <div class="metric">
                    <span>ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ :</span>
                    <span id="memory-usage" class="metric-value">0%</span>
                </div>
                <div class="metric">
                    <span>ë””ìŠ¤í¬ ì‚¬ìš©ë¥ :</span>
                    <span id="disk-usage" class="metric-value">0%</span>
                </div>
                <div class="metric">
                    <span>ë„¤íŠ¸ì›Œí¬ ìˆ˜ì‹ :</span>
                    <span id="data-received" class="metric-value">0 MB</span>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸ”¥ í•˜ë“œì›¨ì–´ ìƒíƒœ</h3>
                <div class="metric">
                    <span>ë””ì‹œ ì˜¨ë„:</span>
                    <span id="dish-temperature" class="metric-value">0Â°C</span>
                </div>
                <div class="metric">
                    <span>ì „ë ¥ ì†Œëª¨:</span>
                    <span id="power-consumption" class="metric-value">0W</span>
                </div>
                <div class="metric">
                    <span>ì—°ê²° íƒ€ì…:</span>
                    <span id="connection-type" class="metric-value">starlink_mini</span>
                </div>
                <div class="metric">
                    <span>ì—…ë°ì´íŠ¸ íšŸìˆ˜:</span>
                    <span id="update-count" class="metric-value status-good">0</span>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ì°¨íŠ¸</h3>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”¥ ëª…ì‹œì ìœ¼ë¡œ í¬íŠ¸ 9999 ì§€ì •í•˜ì—¬ WebSocket ì—°ê²°
        const socket = io(':9999');
        let chart;
        let updateCount = 0;
        const chartData = {
            labels: [],
            datasets: [
                {
                    label: 'ë‹¤ìš´ë¡œë“œ ì†ë„ (Mbps)',
                    data: [],
                    borderColor: '#00D2FF',
                    backgroundColor: 'rgba(0, 210, 255, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'ì‹ í˜¸ ê°•ë„ (%)',
                    data: [],
                    borderColor: '#4CAF50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.4
                }
            ]
        };
        
        function initChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: 'white' } } },
                    scales: {
                        x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }
        
        function updateData(data) {
            updateCount++;
            
            // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
            document.getElementById('api-status').textContent = data.api_status || 'unknown';
            document.getElementById('uptime').textContent = data.uptime_formatted || '00:00:00';
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            document.getElementById('update-count').textContent = updateCount;
            
            document.getElementById('connection-api').textContent = data.api_status || 'unknown';
            document.getElementById('connection-grpc').textContent = data.connection_status || 'unknown';
            document.getElementById('ping-latency').textContent = (data.ping_latency_ms || 0) + ' ms';
            document.getElementById('signal-strength').textContent = (data.signal_strength || 0) + '%';
            
            document.getElementById('download-speed').textContent = (data.download_speed_mbps || 0) + ' Mbps';
            document.getElementById('upload-speed').textContent = (data.upload_speed_mbps || 0) + ' Mbps';
            document.getElementById('network-latency').textContent = (data.latency_ms || 0) + ' ms';
            document.getElementById('satellite-count').textContent = data.satellite_count || 0;
            
            document.getElementById('cpu-usage').textContent = (data.cpu_percent || 0) + '%';
            document.getElementById('memory-usage').textContent = (data.memory_percent || 0) + '%';
            document.getElementById('disk-usage').textContent = (data.disk_usage_percent || 0) + '%';
            document.getElementById('data-received').textContent = (data.data_received_mb || 0) + ' MB';
            
            document.getElementById('dish-temperature').textContent = (data.dish_temperature || 0) + 'Â°C';
            document.getElementById('power-consumption').textContent = (data.power_consumption_w || 0) + 'W';
            document.getElementById('connection-type').textContent = data.connection_type || 'unknown';
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            const now = new Date().toLocaleTimeString();
            chartData.labels.push(now);
            chartData.datasets[0].data.push(data.download_speed_mbps || 0);
            chartData.datasets[1].data.push(data.signal_strength || 0);
            
            if (chartData.labels.length > 20) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
                chartData.datasets[1].data.shift();
            }
            
            if (chart) chart.update('none');
            
            // ì‹¤ì‹œê°„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
            document.getElementById('realtime-status').innerHTML = `ğŸŸ¢ ì‹¤ì‹œê°„ #${updateCount}`;
        }
        
        function startMonitoring() {
            fetch('/api/start').then(r => r.json()).then(data => {
                console.log('ëª¨ë‹ˆí„°ë§ ì‹œì‘:', data);
            });
        }
        
        function stopMonitoring() {
            fetch('/api/stop').then(r => r.json()).then(data => {
                console.log('ëª¨ë‹ˆí„°ë§ ì¤‘ì§€:', data);
            });
        }
        
        function testWebSocket() {
            console.log('WebSocket ì—°ê²° ìƒíƒœ:', socket.connected);
            if (socket.connected) {
                alert('WebSocket ì—°ê²°ë¨: ' + socket.id);
            } else {
                alert('WebSocket ì—°ê²° ì‹¤íŒ¨');
                socket.connect();
            }
        }
        
        // WebSocket ì´ë²¤íŠ¸ ì²˜ë¦¬
        socket.on('connect', function() {
            console.log('âœ… WebSocket ì—°ê²° ì„±ê³µ:', socket.id);
            document.getElementById('websocket-status').innerHTML = 'WebSocket: âœ… ì—°ê²°ë¨';
            document.getElementById('websocket-status').className = 'connection-status';
            document.getElementById('realtime-status').innerHTML = 'ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ê²°';
        });
        
        socket.on('disconnect', function() {
            console.log('âŒ WebSocket ì—°ê²° í•´ì œ');
            document.getElementById('websocket-status').innerHTML = 'WebSocket: âŒ ì—°ê²° í•´ì œ';
            document.getElementById('websocket-status').className = 'connection-status disconnected';
            document.getElementById('realtime-status').innerHTML = 'ğŸ”´ ì—°ê²° ëŠê¹€';
        });
        
        socket.on('update', function(data) {
            console.log('ğŸ“¡ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ :', data.timestamp);
            updateData(data);
        });
        
        socket.on('status', function(msg) {
            console.log('ğŸ“Š ìƒíƒœ ë°ì´í„°:', msg);
            if (msg.data) updateData(msg.data);
        });
        
        socket.on('connect_error', function(error) {
            console.error('WebSocket ì—°ê²° ì˜¤ë¥˜:', error);
            document.getElementById('websocket-status').innerHTML = 'WebSocket: âŒ ì—°ê²° ì˜¤ë¥˜';
            document.getElementById('websocket-status').className = 'connection-status disconnected';
        });
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, WebSocket ì´ˆê¸°í™”');
            initChart();
            startMonitoring();
        });
    </script>
</body>
</html>
